/*!
 * vimeo.ga.js | v0.5.1
 * Based on modifications by LukasBeaton (https://github.com/LukasBeaton/vimeo.ga.js)
 * Copyright (c) 2015 Sander Heilbron (http://www.sanderheilbron.nl)
 * MIT licensed
 */

var vimeoGAJS={iframes:[],gaTracker:void 0,eventMarker:{},init:function(){vimeoGAJS.iframes=$('iframe[src*="vimeo.com"]'),$.each(vimeoGAJS.iframes,function(e,o){var t=$(o).attr("id");vimeoGAJS.eventMarker[t]={progress25:!1,progress50:!1,progress75:!1,videoPlayed:!1,videoPaused:!1,videoResumed:!1,videoSeeking:!1,videoCompleted:!1,timePercentComplete:0}}),"function"==typeof ga&&(vimeoGAJS.gaTracker="ua"),"undefined"!=typeof _gaq&&"function"==typeof _gaq.push&&(vimeoGAJS.gaTracker="ga"),"undefined"!=typeof dataLayer&&"function"==typeof dataLayer.push&&(vimeoGAJS.gaTracker="gtm"),window.addEventListener?window.addEventListener("message",vimeoGAJS.onMessageReceived,!1):window.attachEvent("onmessage",vimeoGAJS.onMessageReceived,!1)},onMessageReceived:function(e){if("http://player.vimeo.com"===e.origin.replace("https:","http:")&&"undefined"!=typeof vimeoGAJS.gaTracker){var o=JSON.parse(e.data),t=$("#"+o.player_id),i=t.attr("id");switch(o.event){case"ready":vimeoGAJS.onReady();break;case"playProgress":vimeoGAJS.onPlayProgress(o.data,t);break;case"seek":t.data("seek")&&!vimeoGAJS.eventMarker[i].videoSeeking&&(vimeoGAJS.sendEvent(t,"Skipped video forward or backward"),vimeoGAJS.eventMarker[i].videoSeeking=!0);break;case"play":vimeoGAJS.eventMarker[i].videoPlayed?!vimeoGAJS.eventMarker[i].videoResumed&&vimeoGAJS.eventMarker[i].videoPaused&&(vimeoGAJS.sendEvent(t,"Resumed video"),vimeoGAJS.eventMarker[i].videoResumed=!0):(vimeoGAJS.sendEvent(t,"Started video"),vimeoGAJS.eventMarker[i].videoPlayed=!0);break;case"pause":vimeoGAJS.onPause(t);break;case"finish":vimeoGAJS.eventMarker[i].videoCompleted||(vimeoGAJS.sendEvent(t,"Completed video"),vimeoGAJS.eventMarker[i].videoCompleted=!0)}}},getUrl:function(e){var o=document.URL.split(":")[0];return null===e.match(/^http/)?o+":"+e:e},post:function(e,o,t){var i={method:e};o&&(i.value=o);var r=$(t).attr("src").split("?")[0];t.contentWindow.postMessage(JSON.stringify(i),vimeoGAJS.getUrl(r))},onReady:function(){$.each(vimeoGAJS.iframes,function(e,o){vimeoGAJS.post("addEventListener","play",o),vimeoGAJS.post("addEventListener","seek",o),vimeoGAJS.post("addEventListener","pause",o),vimeoGAJS.post("addEventListener","finish",o),vimeoGAJS.post("addEventListener","playProgress",o)})},onPause:function(e){var o=e.attr("id");vimeoGAJS.eventMarker[o].timePercentComplete<99&&!vimeoGAJS.eventMarker[o].videoPaused&&(vimeoGAJS.sendEvent(e,"Paused video"),vimeoGAJS.eventMarker[o].videoPaused=!0)},onPlayProgress:function(e,o){var t,i=o.attr("id");vimeoGAJS.eventMarker[i].timePercentComplete=Math.round(100*e.percent),o.data("progress")&&(vimeoGAJS.eventMarker[i].timePercentComplete>24&&!vimeoGAJS.eventMarker[i].progress25&&(t="Played video: 25%",vimeoGAJS.eventMarker[i].progress25=!0),vimeoGAJS.eventMarker[i].timePercentComplete>49&&!vimeoGAJS.eventMarker[i].progress50&&(t="Played video: 50%",vimeoGAJS.eventMarker[i].progress50=!0),vimeoGAJS.eventMarker[i].timePercentComplete>74&&!vimeoGAJS.eventMarker[i].progress75&&(t="Played video: 75%",vimeoGAJS.eventMarker[i].progress75=!0),t&&vimeoGAJS.sendEvent(o,t))},sendEvent:function(e,o){var t=e.attr("src").split("?")[0],i=e.data("bounce");switch(vimeoGAJS.gaTracker){case"gtm":dataLayer.push({event:"Vimeo",eventCategory:"Vimeo",eventAction:o,eventLabel:vimeoGAJS.getUrl(t),eventValue:void 0,eventNonInteraction:i?!1:!0});break;case"ua":ga("send","event","Vimeo",o,vimeoGAJS.getUrl(t),void 0,{nonInteraction:i?0:1});break;case"ga":_gaq.push(["_trackEvent","Vimeo",o,vimeoGAJS.getUrl(t),void 0,i?!1:!0])}}};$(function(){vimeoGAJS.init()});